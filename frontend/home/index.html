<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

    <title>Furries | Ragnarok M </title>
    <link rel="shortcut icon" type="image/x-icon" href="images/moonlight.ico" />

  <!-- Custom fonts for this template-->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">


  <!-- Custom styles for this template-->
  <link href="css/sb-admin-2.css" rel="stylesheet">
  <link href="css/custom.css" rel="stylesheet">

</head>

<body id="page-top">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-6 static-top shadow">

          <!-- Sidebar Toggle (Topbar) -->
          <!-- /top tiles -->
          <div class="row">
               <h5 class="titlePt">Grupos do dia: </h5><a id="crrDate"></a>
          </div>


          <ul class="navbar-nav ml-auto">

            <div class="topbar-divider d-none d-sm-block"></div>

            <!-- Nav Item - User Information -->
            <li class="nav-item dropdown no-arrow">
              <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="mr-2 d-none d-lg-inline text-gray-600 small"><b>Furries</b></span>
                <img class="img-profile rounded-circle romlogo" src="images/moonlight.ico">
              </a>
            </li>

          </ul>          

        </nav>
        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid createArea">

          <!-- /top tiles -->
          <div class="row">
            <div class="col-md-2">
              <button class="btn btn-primary" id="createParty">Criar Grupo</button>
            </div>
            <div class="col-md-1">
              <button class="btn btn-danger" id="reset">reset</button>
            </div>
          </div>

          <hr>

          <div id="partiesList">         

          </div>

        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Furries &copy; 2019</span>
          </div>
        </div>
      </footer>
      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Bootstrap core JavaScript-->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>

  <!-- Custom scripts for all pages-->
  <script src="js/sb-admin-2.min.js"></script>

</body>

  <!-- Modal -->
  <div class="modal fade" id="groupModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Novo Grupo</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

          <div class="row">
             <div class="form-group">
               <label for="groupname">Nome do Grupo</label>
               <input type="text" class="form-control" id="groupName" maxlength="25" aria-describedby="groupHelp" placeholder="Grupo">
               <small id="groupHelp" class="form-text text-muted">Ex: (Torre 0F, Torre 50F+, Valhala 40, Rift, Evento, PVP, etc)</small>
             </div>
             <div>
              <div class="form-group">
               <label for="groupTime">Horário</label>
               <input type="text" class="form-control" id="groupTime" maxlength="10" aria-describedby="groupTimeHelp" placeholder="Horário">
               <small id="groupTimeHelp" class="form-text text-muted">Horário de realização da missão.</small>
             </div>               
             </div>
             <div class="row">
               <div class="col-md-6">
                  <div class="form-group">
                   <label for="groupLeader">Seu Nick</label>
                   <input type="text" class="form-control" id="groupLeader" maxlength="25" aria-describedby="groupLeaderHelp" placeholder="Nick">
                 </div>                
               </div>
               <div class="col-md-6">
                 <div class="form-group">
                   <label for="groupname">Sua Classe</label>
                   <input type="text" class="form-control" maxlength="15" id="playerClass" aria-describedby="playerClassHelp" placeholder="Classe">
                   <small id="playerClassHelp" class="form-text text-muted">Ex: (Sinx, Sniper, Paladin, etc.)</small>
                 </div>                   
               </div>
             </div>                
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
          <button type="button" id="openParty" class="btn btn-success">Criar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Join -->
  <div class="modal fade" id="joinGroupModal" tabindex="-1" role="dialog" aria-labelledby="joinGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Entrar em Grupo</h5> <a id="joinGroupName"></a> <a id="joinGroupTime"></a>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

             <div class="row">
               <div class="col-md-6">
                  <div class="form-group">
                   <label for="groupLeader">Seu Nick</label>
                   <input type="text" class="form-control" maxlength="25" id="playerName" aria-describedby="playerNameHelp" placeholder="Nick">
                 </div>                
               </div>
               <div class="col-md-6">
                 <div class="form-group">
                   <label for="groupname">Sua Classe</label>
                   <input type="text" class="form-control" maxlength="15" id="playerJoinClass" aria-describedby="playerClassHelp" placeholder="Classe">
                   <small id="playerClassHelp" class="form-text text-muted">Ex: (Sinx, Sniper, Paladin, etc.)</small>
                 </div>                   
               </div>
             </div>                

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-success joinParty">Entrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Leave -->
  <div class="modal fade" id="leaveGroupModal" tabindex="-1" role="dialog" aria-labelledby="leaveGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Remover Membro do Grupo</h5> <a id="joinGroupName"></a> <a id="joinGroupTime"></a>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
             <small>Deseja remover o membro do Grupo?</small>
             <div class="row">
               <div class="col-md-12">
                  <div class="form-group">
                   <label for="groupLeader"> Confirme o Nick do Jogador a ser removido.</label>
                   <input type="text" class="form-control" maxlength="25" id="rmPlayerName" aria-describedby="playerNameHelp" placeholder="Nick">
                 </div>                
               </div>
             </div>                

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger removeFromParty">Remover</button>
        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
   $( document ).ready(function() {

        // PartyComponent
        var partyComponentOuter = '<div class="row"><div class="col-md-4 col-sm-4 col-xs-12">';
        var partyComponentBox = '<div class="x_panel"><div class="x_title">';
        var partyTitle = '<h2><a class="partyName';
        var partyTime = ' "></a><small class="party';
        var partyTime2 = 'Time"></small>';
        var partyComponentBoxInner = '</h2><div class="clearfix"></div></div><div class="x_content"><div class="dashboard-widget-content">'; 
        var partyComponentMemberArea = '<ul class=" party';
        var partyComponentMemberArea2 = 'MemberList list-unstyled timeline widget"></ul><button data-pid=';
        var partyComponenetJoinButtonAndClosing = ' class="btn btn-success btnOpenJoin">Entrar no grupo</button></div></div></div></div>';

        var memberAreaOuter = ' <li class="partyMember"><div class="block"><div class="block_content"><div class="row"><div class="col-md-10"><h2 class="title">';
        var memberAreaIdentificator = '<a class="party';
        var memberAreaIdentificator2 = 'MemberName';
        var memberAreaIdentificator3 = '">';
        var memberClassOuter = '</a></h2><div class="byline"><span class="party';
        var memberClassName = 'Member';
        var memberClassName2 = 'Class">';
        var closing = '</span></div></div><div class="col-md-2">';
        var buttonLeave1 = '<button data-rmnick=';
        var buttonDataPid = ' data-pidleave=';
        var buttonLeave2Closing = ' title="Remover Membro" class="btn btn-danger btnLeavePt"><i class="fas fa-times"></i></button></div></div></div></div></li> ';

       // PartyComponent End

       // Global Variables
        var pid;
        var pidLeave;
        var playerToRemove;
        var apiPath = 'http://3.95.232.56';

       // Model Triggers

       $( "#createParty" ).click(function() {
            $("#groupModal").modal("show");
            var groupName = $("#groupName").val("");
            var groupTime = $("#groupTime").val("");
            var groupLeader = $("#groupLeader").val("");
            var playerClass = $("#playerClass").val("");
        }); 

        $('body').on('click', '.btnOpenJoin', function(e) {
            var playerName = $("#playerName").val("");
            var playerClass = $("#playerJoinClass").val("");  
            pid = "";
            $("#joinGroupModal").modal("show"); 
            pid = $(this).data("pid");       
        });

        $('body').on('click', '.btnLeavePt', function(e) {
            $("#leaveGroupModal").modal("show");
             pidLeave = $(this).data("pidleave");  
             playerToRemove = $(this).data("rmnick");
        }); 

        $("#crrDate").html(dataAtualFormatoBR());

        getAllParties();

        function getAllParties(){

          $("#partiesList").html("");

          $.get( apiPath+"/get_parties", function( data ) {
              var list = JSON.parse( data );

              var partyList = [];
              var i;
              var j;

              if(list.children.length == 0){
                $("#partiesList").html("");
                $("#partiesList").append("Nenhum grupo criado hoje!");
              }

              $.each(list, function(index, parties) {
                 partyList = parties;            
              });


              for (i = 0; i < partyList.length; i++) { 

                $("#partiesList").append(partyComponentOuter+partyComponentBox+
                  partyTitle+i+partyTime+i+partyTime2+
                  partyComponentBoxInner+
                  partyComponentMemberArea+i+
                  partyComponentMemberArea2+
                  partyList[i].pid+partyComponenetJoinButtonAndClosing);
                 
                 $(" .partyName"+i+" ").html(partyList[i].name);
                 $(" .party"+i+"Time ").html(partyList[i].pt_time);

                 for (j = 0; j < partyList[i].children.length; j++){
                    $(".party"+i+"MemberList").append(memberAreaOuter+
                      memberAreaIdentificator+i+memberAreaIdentificator2+j+memberAreaIdentificator3+partyList[i].children[j].name+
                      memberClassOuter+i+memberClassName+j+memberClassName2+
                      partyList[i].children[j].class+closing+
                      buttonLeave1+partyList[i].children[j].name+
                      buttonDataPid+partyList[i].pid+
                      buttonLeave2Closing);
                 }

              }

          });

        }


        $('body').on('click', '.joinParty', function(e) {

            var playerName = $("#playerName").val();
            var playerClass = $("#playerJoinClass").val();  

            $.get( apiPath+"/join_party/"+playerName+"/"+playerClass+"/"+pid+" ", function( data ) {


              if(data == "pt full"){
                $("#joinGroupModal").modal("hide");
                Swal.fire("Ops!", "Este grupo já está cheio! (Limite: 5 Membros)", "error");
                return;
              }

              if(data != "no pt found" && data != "pt full"){
                $("#joinGroupModal").modal("hide");
                Swal.fire("Boa aventura!", "Divirta-se", "success");
                pid = "";
                getAllParties();
              }

           });

        });

        $( "#openParty" ).click(function() {
           var groupName = $("#groupName").val();
           var groupTime = $("#groupTime").val();
           var groupLeader = $("#groupLeader").val();
           var playerClass = $("#playerClass").val();

           $.get( apiPath+"/create_party/"+groupName+"/"+groupTime+"/"+groupLeader+"/"+playerClass+" ", function( data ) {

              if(data == 0){
                $("#groupModal").modal("hide");
                getAllParties();
              }

           });

        });        


       $('body').on('click', '.removeFromParty', function(e) {
            var playerName = $("#rmPlayerName").val();

            if(playerName != playerToRemove){
               Swal.fire("Ops!", "Nick não corresponde ao membro selecionado para remoção", "error");
              return;
            }  

            $.get( apiPath+"/leave_party/"+playerName+"/"+pidLeave+" ", function( data ) {

              if(data == "player not found"){
                $("#leaveGroupModal").modal("hide");
                Swal.fire("Ops!", "Este grupo não possui nenhum jogador com este nick", "error");
                return;
              }

              if(data == 0){
                pidLeave = "";
                $("#leaveGroupModal").modal("hide");
                getAllParties();
              }

           });

        }); 

        function dataAtualFormatoBR(){
          var d = new Date().getDate();
          var m = new Date().getMonth();
          m = m + 1;
          var y = new Date().getFullYear();
          return " "+d+"/"+m+"/"+y;
        }

    });   
  </script>

</html>
